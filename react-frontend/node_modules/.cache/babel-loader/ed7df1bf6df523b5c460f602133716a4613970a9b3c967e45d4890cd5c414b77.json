{"ast":null,"code":"import { jwtDecode } from 'jwt-decode';\nimport { api } from '../services/api';\nexport async function standardFetch(input) {\n  const {\n    url,\n    method = 'GET',\n    body,\n    contentType,\n    controller\n  } = input;\n  const headers = {\n    'Content-Type': contentType\n  };\n  const token = localStorage.getItem('token');\n  if (token) {\n    headers.Authorization = `Bearer ${token}`;\n  } else {\n    console.warn('No token found, user may not be authenticated');\n  }\n  const config = {\n    url,\n    method,\n    headers,\n    data: body,\n    signal: controller === null || controller === void 0 ? void 0 : controller.signal\n  };\n  try {\n    const response = await api(config);\n    return response.data;\n  } catch (error) {\n    if (error.response) {\n      console.error('Axios error response:', error.response);\n      throw error.response.data;\n    } else {\n      console.error('Axios error:', error.message);\n      throw new Error('An unexpected error occurred.');\n    }\n  }\n}\nexport const fetchUser = async userId => {\n  return standardFetch({\n    url: `/User/getByUsername/${userId}`,\n    contentType: 'application/json'\n  });\n};\nexport const fetchUserByEmail = async userId => {\n  return standardFetch({\n    url: `/User/getByEmail/${userId}`,\n    contentType: 'application/json'\n  });\n};\nexport const isUserLoggedIn = () => {\n  try {\n    let token = localStorage.getItem('authToken');\n    if (!token) {\n      return false;\n    }\n    const decodedToken = jwtDecode(token);\n    const currentTime = Math.floor(Date.now() / 1000);\n    if (decodedToken.exp < currentTime) {\n      return false;\n    }\n    return true;\n  } catch (e) {\n    console.error('Error decoding token:', e);\n    return false;\n  }\n};\nexport const getLoggedInUserData = async () => {\n  try {\n    let token = localStorage.getItem('authToken');\n    if (!token) {\n      return {};\n    }\n    const decodedToken = jwtDecode(token);\n    const username = decodedToken.Username;\n    return username;\n  } catch (e) {\n    console.error('Error decoding token or fetching user data:', e);\n    return {};\n  }\n};","map":{"version":3,"names":["jwtDecode","api","standardFetch","input","url","method","body","contentType","controller","headers","token","localStorage","getItem","Authorization","console","warn","config","data","signal","response","error","message","Error","fetchUser","userId","fetchUserByEmail","isUserLoggedIn","decodedToken","currentTime","Math","floor","Date","now","exp","e","getLoggedInUserData","username","Username"],"sources":["C:/Users/umerb/OneDrive/Desktop/testApp/react-frontend/src/utils/fetches.tsx"],"sourcesContent":["import axios, { AxiosRequestConfig } from 'axios';\r\nimport { jwtDecode } from 'jwt-decode';\r\nimport { api } from '../services/api';\r\n\r\ninterface StandardFetchInput {\r\n  url: string;\r\n  method?: 'GET' | 'POST' | 'PUT' | 'DELETE';\r\n  body?: any;\r\n  contentType: string;\r\n  controller?: AbortController | null;\r\n}\r\n\r\n\r\ninterface CommonProfileProps {\r\n  userId: number;\r\n  username: string;\r\n  passwordHash: string;\r\n  phoneNumber: string;\r\n  email: string;\r\n  deviceIdentifier: string;\r\n  lastKnownIP: string;\r\n  userAgent: string;\r\n  operatingSystem: string;\r\n  browserName: string;\r\n  trustedDevice: boolean;\r\n  lastLoginDate: Date;\r\n}\r\n\r\n\r\nexport async function standardFetch<T>(input: StandardFetchInput): Promise<T> {\r\n    const { url, method = 'GET', body, contentType, controller } = input;\r\n\r\n    const headers: Record<string, string> = {\r\n        'Content-Type': contentType,\r\n    };\r\n\r\n    const token = localStorage.getItem('token');\r\n    if (token) {\r\n        headers.Authorization = `Bearer ${token}`;\r\n    } else {\r\n        console.warn('No token found, user may not be authenticated');\r\n    }\r\n\r\n    const config: AxiosRequestConfig = {\r\n        url,\r\n        method,\r\n        headers,\r\n        data: body,\r\n        signal: controller?.signal,\r\n    };\r\n\r\n    try {\r\n        const response = await api(config);\r\n        return response.data as T;\r\n    } catch (error: any) {\r\n        if (error.response) {\r\n            console.error('Axios error response:', error.response);\r\n            throw error.response.data; \r\n        } else {\r\n            console.error('Axios error:', error.message);\r\n            throw new Error('An unexpected error occurred.');\r\n        }\r\n    }\r\n}\r\n\r\n\r\ntype User = CommonProfileProps;\r\nexport const fetchUser = async (userId: string): Promise<User> => {\r\n  return standardFetch<User>({\r\n    url: `/User/getByUsername/${userId}`,\r\n    contentType: 'application/json',\r\n  });\r\n};\r\n\r\nexport const fetchUserByEmail = async (userId: string): Promise<User> => {\r\n    return standardFetch<User>({\r\n      url: `/User/getByEmail/${userId}`,\r\n      contentType: 'application/json',\r\n    });\r\n  };\r\n\r\nexport const isUserLoggedIn = () => {\r\n    try {\r\n        let token = localStorage.getItem('authToken');\r\n\r\n        if (!token) {\r\n         \r\n            return false;\r\n        }\r\n\r\n     \r\n        const decodedToken = jwtDecode<{ exp: number }>(token); \r\n        \r\n    \r\n        const currentTime = Math.floor(Date.now() / 1000);\r\n        if (decodedToken.exp < currentTime) {\r\n          \r\n            return false;\r\n        }\r\n\r\n        return true; \r\n    } catch (e) {\r\n        console.error('Error decoding token:', e);\r\n        return false;\r\n    }\r\n};\r\n\r\nexport const getLoggedInUserData = async () => {\r\n    try {\r\n      let token: any = localStorage.getItem('authToken');\r\n      if (!token) {\r\n        return {};\r\n      }\r\n      const decodedToken = jwtDecode<{ Username: string }>(token); \r\n     \r\n      const username = decodedToken.Username;\r\n\r\n      return username; \r\n    } catch (e) {\r\n      console.error('Error decoding token or fetching user data:', e);\r\n      return {};\r\n    }\r\n  };\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}